<html>

<head>
<meta charset="utf-8">
<title>Highways England Road Safety Visualiser</title>

<!-- styles -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
	integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	crossorigin="anonymous">
</link>

<style type="text/css">
.defaultForm {
	width: 50%;
	clear: both;
}

.defaultForm input {
	width: 75px;
	clear: both;
}
</style>

<!-- script imports -->
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
	integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
	crossorigin="anonymous"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
</head>

<body>
	<div class="container">

		<div>
			<h1>Highways England Road Safety Visualiser</h1>
		</div>

		<hr>

		<form class="defaultForm">
			<!-- 
                <div class="form-group" align="left">
                    <label for="company">Polling Organisation</label> 
                    <br>
                    <select id="company"></select> <br>
                    <br> 
                    <label for="sampleSize">Sample Size</label> 
                    <input type="number" min="2" max="100" class="form-control" id="sampleSize"
                        placeholder="5">
                </div>
                <br>
                 -->
			<button id="go" type="submit" class="btn btn-success">Go!</button>
		</form>

		<canvas id="pieChart"></canvas>

	</div>

	<script>
        	// keep objects in global scope
        	var roadCountChart;
        	var colours = [];
        	

        	function refreshVisualiser()
        	{
        		setInterval(function() {
            		runVisualiser();
        		}, 60000);
            }
        	
            function runVisualiser()
            {
            	
                $.ajax(
                {
                    url: '/api/get/count/road',
                    dataType: 'json',
                }).done(function(json)
                {
					console.log(json);
					
                    var data = [], labels = [];
                    

                    json.forEach((entry) =>
                    {
                        labels.push(entry.road);
                        data.push(entry.count);
                    });

                    var tempData = {
                    	      labels : labels,
                    	      datasets : [{
                        	      backgroundColor: "red",
                    	          data: data
                    	      }]
                    	    };

                    var ctx = document.getElementById("pieChart").getContext("2d");

					if (roadCountChart != null)
					{
						roadCountChart.destroy();
					}
					
					roadCountChart = new Chart(ctx,
                    {
                        type: "doughnut",
                        data: tempData
                    });
                });
            }

            function generateColours()
            {
					colours.push("red");
					colours.push("yellow");
					colours.push("green");
					colours.push("blue");
					colours.push("red");
            }

            $(document).ready(function()
            {
            	
            	generateColours();
                runVisualiser();
                refreshVisualiser();


            });

        </script>
</body>

</html>
